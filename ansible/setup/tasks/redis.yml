---

#- name: install epel repo for redis REPLACE THIS WITH A DOWNLOAD OF LATEST VERSION FROM REDIS WEBSITE
#  yum: name=epel-release state=installed
#- name: Install redis
#  yum: name=redis state=installed
#- name: enable redis
#  service: name=redis enabled=yes

###################

- name: Install redis - Download from redis website
  file: path="{{ base_dir }}/redis" state=directory
  tags: install redis
- name: Install redis - Download from redis website
  get_url: url=http://download.redis.io/releases/redis-{{ redis_version }}.tar.gz
           dest="{{ base_dir }}/redis/redis.tar.gz" mode=0444
  tags: redis
- name: Install redis - Unarchive redis tarball
  unarchive: src="{{ base_dir }}/redis/redis.tar.gz" dest="{{ base_dir }}/redis"
             owner={{ username }} copy=no creates={{ base_dir }}/redis/redis-{{ redis_version }}
  tags: install redis
- name: Install redis - make
  command: make
  args:
    chdir: "{{ base_dir }}/redis/redis-{{ redis_version }}"
    creates: "{{ base_dir }}/redis/redis-{{ redis_version }}/src/redis-server"
  tags: install redis

- name: Install redis - make Install
  become: yes
  become_user: root
  command: make install
  args:
    chdir: "{{ base_dir }}/redis/redis-{{ redis_version }}"
    creates: /usr/local/bin/redis-server
  tags: install redis

- name: Create the redis startup service
  become: yes
  become_user: root
  template: src=deploy/templates/redis.service.j2 dest=/etc/systemd/system/redis.service
            backup=yes owner=nginx group=nginx mode=0750
  tags: install redis

- name: enable redis service
  become: yes
  become_user: root
  service: name=redis.service enabled=yes
  tags: install redis
###################
